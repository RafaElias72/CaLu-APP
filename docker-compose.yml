
services:
  # Backend Service (Go)
  backend:
    build:
      context: ./2025_Calu_back/api-CaLuFestas-Site
      dockerfile: Dockerfile
    container_name: calu-backend
    ports:
      - "8080:8080"
    environment:
      - PORT=8080
      - MONGO_URI=mongodb://mongo:27017/calufestas
      - SMTP_HOST=smtp.gmail.com
      - SMTP_PORT=587
      - SMTP_EMAIL=your-email@gmail.com 
      - SMTP_PSW=your-app-password
      # Add other env vars here or use env_file: .env
    depends_on:
      - mongo
    networks:
      - calu-network

  # Frontend Service (React + Nginx)
  frontend:
    build:
      context: ./2025_CaLu/CaluFestas-Site
      dockerfile: Dockerfile
    container_name: calu-frontend
    ports:
      - "5173:80"
    environment:
      - VITE_N8N_WEBHOOK_URL=http://localhost:5678/webhook/calu-chat
    depends_on:
      - backend
    networks:
      - calu-network

  # n8n Service
  n8n:
    image: docker.n8n.io/n8nio/n8n
    container_name: calu-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - NODE_ENV=production
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/Sao_Paulo
    volumes:
      - n8n_data:/home/node/.n8n
    networks:
      - calu-network

  # MongoDB Service (Local DB)
  mongo:
    image: mongo:latest
    container_name: calu-mongo
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db
    networks:
      - calu-network

networks:
  calu-network:
    driver: bridge

volumes:
  n8n_data:
  mongo_data:
